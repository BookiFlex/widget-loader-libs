/*!
 * 
 *   @bookiflex/widget-loader v0.5.1
 *   https://github.com/menshakov/bookiflex-widget-loader
 *
 *   Copyright (c) Vitali Menshakov (https://menshakov.com).
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BookiFlexWidgetLoader=e():t.BookiFlexWidgetLoader=e()}(self,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(){}t.r(e),t.d(e,{default:()=>ot});const r=t=>t;function o(t,e){for(const n in e)t[n]=e[n];return t}function i(t){return t()}function s(){return Object.create(null)}function a(t){t.forEach(i)}function c(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e}function u(t,e,r){t.$$.on_destroy.push(function(t,...e){if(null==t)return n;const r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}(e,r))}function d(t,e,n){return t.set(n),e}const f="undefined"!=typeof window;let p=f?()=>window.performance.now():()=>Date.now(),h=f?t=>requestAnimationFrame(t):n;const m=new Set;function g(t){m.forEach((e=>{e.c(t)||(m.delete(e),e.f())})),0!==m.size&&h(g)}function y(t,e){t.appendChild(e)}function v(t){t.parentNode.removeChild(t)}function b(t){return document.createElement(t)}function w(){return t=" ",document.createTextNode(t);var t}function $(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function x(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function S(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function k(t,e,n){t.classList[n?"add":"remove"](e)}let _;function P(t){_=t}const E=[],C=[],j=[],O=[],L=Promise.resolve();let T=!1;function A(t){j.push(t)}const z=new Set;let B=0;function H(){const t=_;do{for(;B<E.length;){const t=E[B];B++,P(t),q(t.$$)}for(P(null),E.length=0,B=0;C.length;)C.pop()();for(let t=0;t<j.length;t+=1){const e=j[t];z.has(e)||(z.add(e),e())}j.length=0}while(E.length);for(;O.length;)O.pop()();T=!1,z.clear(),P(t)}function q(t){if(null!==t.fragment){t.update(),a(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const M=new Set;function Y(t,e){-1===t.$$.dirty[0]&&(E.push(t),T||(T=!0,L.then(H)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function I(t,e,r,o,l,u,d,f=[-1]){const p=_;P(t);const h=t.$$={fragment:null,ctx:null,props:u,update:n,not_equal:l,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(p?p.$$.context:[])),callbacks:s(),dirty:f,skip_bound:!1,root:e.target||p.$$.root};d&&d(h.root);let m=!1;if(h.ctx=r?r(t,e.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return h.ctx&&l(h.ctx[e],h.ctx[e]=o)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](o),m&&Y(t,e)),n})):[],h.update(),m=!0,a(h.before_update),h.fragment=!!o&&o(h.ctx),e.target){if(e.hydrate){const t=(b=e.target,Array.from(b.childNodes));h.fragment&&h.fragment.l(t),t.forEach(v)}else h.fragment&&h.fragment.c();e.intro&&((g=t.$$.fragment)&&g.i&&(M.delete(g),g.i(y))),function(t,e,n,r){const{fragment:o,on_mount:s,on_destroy:l,after_update:u}=t.$$;o&&o.m(e,n),r||A((()=>{const e=s.map(i).filter(c);l?l.push(...e):a(e),t.$$.on_mount=[]})),u.forEach(A)}(t,e.target,e.anchor,e.customElement),H()}var g,y,b;P(p)}const N=[];function W(t){const e=t-1;return e*e*e+1}function D(t){return"[object Date]"===Object.prototype.toString.call(t)}function F(t,e){if(t===e||t!=t)return()=>t;const n=typeof t;if(n!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map(((e,n)=>F(t[n],e)));return t=>n.map((e=>e(t)))}if("object"===n){if(!t||!e)throw new Error("Object cannot be null");if(D(t)&&D(e)){t=t.getTime();const n=(e=e.getTime())-t;return e=>new Date(t+e*n)}const n=Object.keys(e),r={};return n.forEach((n=>{r[n]=F(t[n],e[n])})),t=>{const e={};return n.forEach((n=>{e[n]=r[n](t)})),e}}if("number"===n){const n=e-t;return e=>t+e*n}throw new Error(`Cannot interpolate ${n} values`)}function R(t,e={}){const i=function(t,e=n){let r;const o=new Set;function i(e){if(i=e,((n=t)!=n?i==i:n!==i||n&&"object"==typeof n||"function"==typeof n)&&(t=e,r)){const e=!N.length;for(const e of o)e[1](),N.push(e,t);if(e){for(let t=0;t<N.length;t+=2)N[t][0](N[t+1]);N.length=0}}var n,i}return{set:i,update:function(e){i(e(t))},subscribe:function(s,a=n){const c=[s,a];return o.add(c),1===o.size&&(r=e(i)||n),s(t),()=>{o.delete(c),0===o.size&&(r(),r=null)}}}}(t);let s,a=t;function c(n,c){if(null==t)return i.set(t=n),Promise.resolve();a=n;let l=s,u=!1,{delay:d=0,duration:f=400,easing:y=r,interpolate:v=F}=o(o({},e),c);if(0===f)return l&&(l.abort(),l=null),i.set(t=a),Promise.resolve();const b=p()+d;let w;return s=function(t){let e;return 0===m.size&&h(g),{promise:new Promise((n=>{m.add(e={c:t,f:n})})),abort(){m.delete(e)}}}((e=>{if(e<b)return!0;u||(w=v(t,n),"function"==typeof f&&(f=f(t,n)),u=!0),l&&(l.abort(),l=null);const r=e-b;return r>f?(i.set(t=n),!1):(i.set(t=w(y(r/f))),!0)})),s.promise}return{set:c,update:(e,n)=>c(e(a,t),n),subscribe:i.subscribe}}let X,V,{documentElement:K,body:U}=document;function G(t){let e,r,o,i,s,l,u,d,f;return{c(){e=b("div"),r=b("div"),o=w(),i=b("div"),x(r,"class","spmt-overlay"),S(r,"opacity",t[9]),x(i,"class","spmt"),S(i,"width",t[0]+"px"),S(i,"transform","translateX("+(t[2]?-1*t[5]:t[5])+"%)"),x(i,"tabindex",s=!!t[8]&&"0"),k(i,"left",t[2]),x(e,"class",u="spmt-wrap "+t[3]),x(e,"data-no-panel",""),k(e,"novis",!t[8]),k(e,"fixed",t[1])},m(s,a){var u;!function(t,e,n){t.insertBefore(e,n||null)}(s,e,a),y(e,r),y(e,o),y(e,i),t[21](i),t[23](e),d||(f=[$(r,"click",t[4]),(u=l=t[12].call(null,i,t[8]),u&&c(u.destroy)?u.destroy:n),$(i,"keydown",t[22])],d=!0)},p(t,[n]){512&n&&S(r,"opacity",t[9]),1&n&&S(i,"width",t[0]+"px"),36&n&&S(i,"transform","translateX("+(t[2]?-1*t[5]:t[5])+"%)"),256&n&&s!==(s=!!t[8]&&"0")&&x(i,"tabindex",s),l&&c(l.update)&&256&n&&l.update.call(null,t[8]),4&n&&k(i,"left",t[2]),8&n&&u!==(u="spmt-wrap "+t[3])&&x(e,"class",u),264&n&&k(e,"novis",!t[8]),10&n&&k(e,"fixed",t[1])},i:n,o:n,d(n){n&&v(e),t[21](null),t[23](null),d=!1,a(f)}}}function J(t,e,n){let r,o,i,s,a,c,l,f,p,{target:h=null}=e,{content:m=null}=e,{width:g=400}=e,{duration:y=450}=e,{fixed:v=!0}=e,{left:b=!1}=e,{dragOpen:w=!0}=e,{onShow:$=null}=e,{onHide:x=null}=e,{preventScroll:S=!0}=e,{wrapClass:k=""}=e;m.parentElement?.removeChild(m);const _=R(100,{duration:y,easing:W});u(t,_,(t=>n(5,i=t)));const P=t=>{d(_,i=0,i),p=t?t.target:null},E=()=>{d(_,i=100,i)};function j(t){let e=9===t.keyCode;if(!o||!e)return;const n=l.querySelectorAll("*"),r=Array.from(n).filter((t=>t.tabIndex>=0));if(r.length){t.preventDefault();let e=r.indexOf(document.activeElement);e+=r.length+(t.shiftKey?-1:1),e%=r.length,r[e].focus()}}return t.$$set=t=>{"target"in t&&n(13,h=t.target),"content"in t&&n(14,m=t.content),"width"in t&&n(0,g=t.width),"duration"in t&&n(15,y=t.duration),"fixed"in t&&n(1,v=t.fixed),"left"in t&&n(2,b=t.left),"dragOpen"in t&&n(16,w=t.dragOpen),"onShow"in t&&n(17,$=t.onShow),"onHide"in t&&n(18,x=t.onHide),"preventScroll"in t&&n(19,S=t.preventScroll),"wrapClass"in t&&n(3,k=t.wrapClass)},t.$$.update=()=>{32&t.$$.dirty&&n(9,r=(100-i)/100),32&t.$$.dirty&&n(8,o=i<100)},[g,v,b,k,E,i,l,f,o,r,_,j,function(t){return m&&t.appendChild(m),h.addEventListener("touchstart",(t=>{let e=t.target.closest("[data-no-panel]");if(s=t.changedTouches[0].pageX,a=t.changedTouches[0].pageY,!o&&(e||!w))return void(c=null);let n=h.getBoundingClientRect(),r=o;(b&&s-n.left<30||!b&&n.right-s<30)&&(r=!0),c=r?{start:i,time:t.timeStamp}:null}),{passive:!0}),h.addEventListener("touchmove",(t=>{if(!o&&!c)return;let e=t.changedTouches[0],n=e.pageX-s,r=e.pageY-a;if(!c.go&&t.timeStamp-c.time<150&&(c.go=Math.abs(n)>2*Math.abs(r)),c.go){const t=n/g,e=c.start+t*(b?-100:100);e<=100&&e>=0&&_.set(e,{duration:0})}}),{passive:!0}),h.addEventListener("touchend",(t=>{if(o){let{start:e,time:n}=c,r=t.timeStamp-n,o=e-i;r<300&&Math.abs(o)>5?o>0?P():E():i>70?E():P()}})),{update:t=>{t?(v&&S&&K.scrollHeight>K.clientHeight&&(X=X||getComputedStyle(K).overflowY,V=V||getComputedStyle(U).overflowY,K.style.overflowY="hidden",U.style.overflowY="scroll"),setTimeout((()=>f.focus()),99),$?.(l)):(p?.focus({preventScroll:!0}),v&&S&&(K.style.overflowY=X,U.style.overflowY=X),x?.())}}},h,m,y,w,$,x,S,P,function(t){C[t?"unshift":"push"]((()=>{f=t,n(7,f)}))},t=>27===t.keyCode?E():j(t),function(t){C[t?"unshift":"push"]((()=>{l=t,n(6,l)}))}]}class Q extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=n}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),I(this,t,J,G,l,{target:13,content:14,width:0,duration:15,fixed:1,left:2,dragOpen:16,onShow:17,onHide:18,preventScroll:19,wrapClass:3,show:20,hide:4})}get target(){return this.$$.ctx[13]}set target(t){this.$$set({target:t}),H()}get content(){return this.$$.ctx[14]}set content(t){this.$$set({content:t}),H()}get width(){return this.$$.ctx[0]}set width(t){this.$$set({width:t}),H()}get duration(){return this.$$.ctx[15]}set duration(t){this.$$set({duration:t}),H()}get fixed(){return this.$$.ctx[1]}set fixed(t){this.$$set({fixed:t}),H()}get left(){return this.$$.ctx[2]}set left(t){this.$$set({left:t}),H()}get dragOpen(){return this.$$.ctx[16]}set dragOpen(t){this.$$set({dragOpen:t}),H()}get onShow(){return this.$$.ctx[17]}set onShow(t){this.$$set({onShow:t}),H()}get onHide(){return this.$$.ctx[18]}set onHide(t){this.$$set({onHide:t}),H()}get preventScroll(){return this.$$.ctx[19]}set preventScroll(t){this.$$set({preventScroll:t}),H()}get wrapClass(){return this.$$.ctx[3]}set wrapClass(t){this.$$set({wrapClass:t}),H()}get show(){return this.$$.ctx[20]}get hide(){return this.$$.ctx[4]}}function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,rt(r.key),r)}}function nt(t,e,n){return(e=rt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function rt(t){var e=function(t,e){if("object"!==Z(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==Z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Z(e)?e:String(e)}const ot=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};tt(this,t),nt(this,"version","0.5.1"),nt(this,"container","#bflex-search-plugin"),nt(this,"loaderId","#app-loader"),nt(this,"backgroundColor",null),nt(this,"sidePanel",void 0),nt(this,"dependencies",{css:[{src:"https://cdn.bookiflex.com/sw/dist/BflexSearchWidget.css?ver=".concat(this.version),position:"shadow"}],js:[{src:"https://unpkg.com/vue@2/dist/vue.min.js",position:"head"},{src:"https://unpkg.com/vue-i18n@8/dist/vue-i18n.min.js",position:"head"},{src:"https://cdn.bookiflex.com/sw/dist/BflexSearchWidget.umd.min.js?ver=".concat(this.version),position:"head"}]}),Object.prototype.hasOwnProperty.call(e,"container")&&"string"==typeof e.container&&(this.container=e.container),Object.prototype.hasOwnProperty.call(e,"backgroundColor")&&"string"==typeof e.backgroundColor&&(this.backgroundColor=e.backgroundColor),Object.prototype.hasOwnProperty.call(e,"version")&&"string"==typeof e.version&&(this.version=e.version),this.init(e)}var e,n,r;return e=t,n=[{key:"getVersion",value:function(){return this.version}},{key:"init",value:function(t){var e=this;if(!document.querySelector(this.container))throw new Error("Container with ID: ".concat(this.container," is not found."));var n=this.createShadowContainer(),r=Object.prototype.hasOwnProperty.call(t,"sidePanel")&&"object"===Z(t.sidePanel);r||this.addLoader(n);var o=document.getElementsByTagName("head")[0];this.dependencies.css.filter((function(t){return"head"===t.position})).forEach((function(t){return e.addStyle(t.src,o)}));var i=[];this.dependencies.js.filter((function(t){return"head"===t.position})).forEach((function(t){return i.push(e.addScript(t.src,o))})),Promise.all(i).then((function(){r?e.createSidePanel(t.sidePanel):e.removeLoader(n),e.mount(n,t)})).catch((function(t){throw new Error("Loading scripts are failed: ".concat(t.script))}))}},{key:"createSidePanel",value:function(t){var e=this,n={target:document.body,content:document.querySelector(this.container),width:850,duration:450,fixed:!0,left:!1,dragOpen:!0,preventScroll:!0,wrapClass:""};t&&t.options&&(n=Object.assign(n,t.options));var r,o=t&&t.activatorClass?t&&t.activatorClass:"open-booking-panel",i=document.getElementsByClassName(o);Array.from(i).forEach((function(t){t.addEventListener("click",(function(){e.sidePanel&&e.sidePanel.show()}))})),document.addEventListener("bflex:close-click",(function(){e.sidePanel&&e.sidePanel.hide()})),this.sidePanel=(r=n,new Q({...r,props:r}))}},{key:"addScript",value:function(t,e){return new Promise((function(n,r){var o=document.createElement("script");o.src=t,o.type="text/javascript",o.async=!1,e.append(o),o.onload=function(){return n({script:t})},o.onerror=function(){return r({script:t})}}))}},{key:"createShadowContainer",value:function(){var t=this,e=document.querySelector(this.container);if(!e)throw new Error("Container is not set.");this.backgroundColor&&(e.style.backgroundColor=this.backgroundColor);var n=e.attachShadow({mode:"open"});return this.dependencies.css.filter((function(t){return"shadow"===t.position})).forEach((function(e){return t.addStyle(e.src,n)})),n}},{key:"addStyle",value:function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,e.append(n)}},{key:"addLoader",value:function(t){var e=document.createElement("div");e.style.margin="1em auto",e.id=this.loaderId.slice(1),e.innerHTML='\n            <svg class="loader-animation" width="76" height="76" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#606060">\n                <g fill="none" fill-rule="evenodd">\n                    <g transform="translate(1 1)" stroke-width="2">\n                        <circle stroke-opacity=".5" cx="18" cy="18" r="18"></circle>\n                        <path d="M36 18c0-9.94-8.06-18-18-18"></path>\n                    </g>\n                </g>\n            </svg>\n            <p>Loading...</p>',t.append(e)}},{key:"removeLoader",value:function(t){var e=t.querySelector(this.loaderId);e&&e.remove()}},{key:"mount",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement("div");if(t.append(n),"Vue"in window&&"BflexSearchWidget"in window){var r=this.prepareProps(e);new window.Vue({el:n,render:function(t){return t(window.BflexSearchWidget,{props:r})}})}}},{key:"prepareProps",value:function(t){if("object"!==Z(t))throw new Error("Params are not valid. Init app with params as object.");var e=new URLSearchParams(window.location.search);e.has("bflex_from")&&e.has("bflex_to")&&(t.from=this.sanitize(e.get("bflex_from")),t.to=this.sanitize(e.get("bflex_to"))),e.has("bflex_accommodation_type")&&(t.accommodationType=this.sanitize(e.get("bflex_accommodation_type"))),e.has("bflex_rate_plan")&&(t.ratePlan=this.sanitize(e.get("bflex_rate_plan"))),e.has("bflex_payment_result")&&(t.paymentResult=this.sanitize(e.get("bflex_payment_result"))),e.has("bflex_promo_code")&&(t.promoCode=this.sanitize(e.get("bflex_promo_code")));var n={};return["from","to","promoCode","accommodationType","ratePlan","paymentResult","fixPanel"].forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&"string"==typeof t[e]&&(n[e]=t[e])})),n}},{key:"sanitize",value:function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&grave;"};return t.replace(/[&<>"'/]/gi,(function(t){return e[t]}))}}],n&&et(e.prototype,n),r&&et(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();return e})()));